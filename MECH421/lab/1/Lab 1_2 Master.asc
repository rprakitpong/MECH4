Version 4
SHEET 1 3780 680
WIRE 992 -608 944 -608
WIRE 992 -576 992 -608
WIRE 864 -512 864 -608
WIRE 880 -512 864 -512
WIRE 944 -512 944 -608
WIRE 944 -512 928 -512
WIRE 864 -464 624 -464
WIRE 1088 -464 944 -464
WIRE 624 -416 624 -464
WIRE 448 -352 400 -352
WIRE 448 -320 448 -352
WIRE 2000 -320 1968 -320
WIRE 624 -304 624 -336
WIRE 2000 -272 2000 -320
WIRE 320 -256 320 -352
WIRE 336 -256 320 -256
WIRE 400 -256 400 -352
WIRE 400 -256 384 -256
WIRE -32 -240 -32 -288
WIRE -64 -224 -144 -224
WIRE 1888 -224 1888 -320
WIRE 1904 -224 1888 -224
WIRE 1968 -224 1968 -320
WIRE 1968 -224 1952 -224
WIRE 128 -208 0 -208
WIRE 320 -208 128 -208
WIRE 1088 -208 1088 -464
WIRE 1088 -208 400 -208
WIRE 1392 -208 1088 -208
WIRE 1632 -208 1632 -272
WIRE 1632 -208 1472 -208
WIRE -64 -192 -96 -192
WIRE 1392 -176 1328 -176
WIRE 1536 -176 1472 -176
WIRE 1664 -176 1616 -176
WIRE 1888 -176 1664 -176
WIRE 2176 -176 1968 -176
WIRE -96 -160 -96 -192
WIRE -880 -144 -880 -224
WIRE 1392 -144 1344 -144
WIRE 1520 -144 1472 -144
WIRE 2176 -144 2176 -176
WIRE -32 -128 -32 -176
WIRE 1392 -112 1360 -112
WIRE 1504 -112 1472 -112
WIRE 1520 -112 1520 -144
WIRE 1536 -112 1520 -112
WIRE 1664 -112 1664 -176
WIRE 1664 -112 1616 -112
WIRE 1504 -80 1504 -112
WIRE 1360 -48 1360 -112
WIRE -144 -32 -144 -224
WIRE -80 -32 -144 -32
WIRE 16 -32 0 -32
WIRE 128 -32 128 -208
WIRE 128 -32 80 -32
WIRE 2176 -16 2176 -64
WIRE -880 0 -880 -64
WIRE -880 0 -976 0
WIRE 1344 16 1344 -144
WIRE 1664 16 1664 -112
WIRE 1664 16 1344 16
WIRE -976 48 -976 0
WIRE -880 80 -880 0
WIRE 1232 80 1184 80
WIRE 1328 80 1328 -176
WIRE 1328 80 1312 80
WIRE 1408 80 1328 80
WIRE 1664 80 1664 16
WIRE 1664 80 1488 80
WIRE 1184 144 1184 80
WIRE -288 192 -400 192
WIRE -144 192 -144 -32
WIRE -144 192 -208 192
WIRE 496 192 -144 192
WIRE 2176 192 2176 64
WIRE 2176 192 576 192
WIRE 2176 240 2176 192
WIRE -400 256 -400 192
WIRE -880 272 -880 160
WIRE 2176 336 2176 320
WIRE -400 384 -400 336
FLAG 1184 144 0
FLAG -96 -160 0
FLAG 1504 -80 0
FLAG 2176 336 0
FLAG -400 384 0
FLAG -976 48 0
FLAG -880 -224 Vdd
FLAG -880 272 Vee
FLAG -32 -128 Vee
FLAG -32 -288 Vdd
FLAG 1360 -48 Vdd
FLAG 1632 -272 Vee
FLAG 448 -320 0
FLAG 2000 -272 0
FLAG 624 -304 0
FLAG 992 -576 0
SYMBOL OpAmps\\OP27 -32 -272 R0
SYMATTR InstName U1
SYMBOL AutoGenerated\\PA13 1424 -160 R0
SYMATTR InstName U2
SYMBOL res 1504 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 22k
SYMBOL res 1328 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 2.2k
SYMBOL res -192 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 4.7k
SYMBOL res 16 -48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 33k
SYMBOL res 592 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL res 2160 224 R0
SYMATTR InstName Rs
SYMATTR Value 0.2
SYMBOL voltage -880 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 25
SYMBOL voltage -880 64 R0
WINDOW 3 24 44 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value 25
SYMATTR InstName V2
SYMBOL voltage -400 240 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 2
SYMATTR Value2 AC 1 0
SYMATTR Value PULSE(-0.1 0.1 0 1e-9 1e-9 0.05 0.1)
SYMATTR InstName V3
SYMBOL res 1632 -192 R90
WINDOW 0 12 31 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rcl+
SYMATTR Value 0.2
SYMBOL res 1632 -128 R90
WINDOW 0 5 26 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rcl-
SYMATTR Value 0.2
SYMBOL res 2160 -160 R0
SYMATTR InstName Rm
SYMATTR Value 3
SYMBOL ind 2160 -32 R0
SYMATTR InstName Lm
SYMATTR Value 1.07m
SYMBOL cap 80 -48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 4.7n
SYMBOL sw 416 -208 R90
WINDOW 0 34 6 VRight 2
WINDOW 3 59 61 VRight 2
SYMATTR InstName Si
SYMATTR Value MYSW
SYMBOL sw 1984 -176 R90
WINDOW 0 38 2 VRight 2
WINDOW 3 59 61 VRight 2
SYMATTR InstName S0
SYMATTR Value MYSW
SYMBOL voltage 304 -352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 0
SYMBOL voltage 1872 -320 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 0
SYMBOL voltage 624 -432 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE(-2.5 2.5 0 1e-9 1e-9 0.05 0.1)
SYMBOL sw 960 -464 R90
WINDOW 0 34 6 VRight 2
WINDOW 3 59 61 VRight 2
SYMATTR InstName Sr
SYMATTR Value MYSW
SYMBOL voltage 848 -608 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
TEXT 1400 -272 Left 2 !.include PA13.lib
TEXT 1792 -200 Left 2 ;Vout
TEXT -1000 408 Left 2 !.tran 0 1 0 0.1
TEXT 2192 176 Left 2 ;Vio
TEXT -392 168 Left 2 ;Vir
TEXT -1008 472 Left 2 !;ac oct 100 1 100k
TEXT 48 -1176 Left 2 ;LAB 2 procedure:
TEXT 48 -1136 Left 2 ;Set Si and S0 to be on (Set V4 and V5 to be greater than Vt = 0.5 V)
TEXT 48 -1096 Left 2 ;Set Impedances Z1, Z2, Z3, Z4, Z5
TEXT 48 -1056 Left 2 ;STEP Responses:
TEXT 96 -1016 Left 2 ;Set V_{Ir} to be a 10 Hz square wave with amplitudes 0.1, 0.2, 0.5 V_{pk-pk}. \nMeasure V_{I0} for each amplitude
TEXT 48 -944 Left 2 ;FREQUENCY Responses
TEXT 96 -904 Left 2 ;Set V_{Ir} to be a sine wave with 0.1 V_{pk-pk}. Measure Frequency response of V_{io}
TEXT 56 -856 Left 2 ;DESTABILIZE THE CURRENT CONTROLLER
TEXT 96 -816 Left 2 ;Remove Resistor from Z4, leave capacitor only. Set VIr to be 10 Hz square wave with 0.2 V_{pk-pk} amplitude
TEXT -1032 -1192 Left 2 ;LAB 1 Procedure
TEXT 208 448 Left 2 !.model MYSW SW(Ron = 0.0001, Roff=100Meg, Vt = 0.5, Vh=0)
TEXT 216 480 Left 2 ;This provides the operating conditions for all switches (with label MYSW). \nRon is negligible (but cant be zero), Roff is open circuit (large Resistance).\nVt is threshold voltage for changing switch position. \nVh is hysterisis voltage, but we dont need to worry about that.
TEXT -1032 -1152 Left 2 ;Set Si and S0 to be off (set V4 and V5 to be less than Vt = 0.5V)
TEXT -1032 -1112 Left 2 ;Set R1 and R2 such that gain of voltage stage is 11
TEXT 984 -488 Left 2 ;Vr
TEXT -1032 -1024 Left 2 ;STEP Responses: Voltage Stage alone
TEXT -992 -984 Left 2 ;Set V_r to be 10Hz square wave withe amplitudes 0.2, 0.5, 5.0 V V_{pk-pk}
TEXT -992 -944 Left 2 ;Measure step response of output V_0 for each
TEXT -1032 -896 Left 2 ;FREQUENCY Responses: Voltage Stage Alone
TEXT -1000 -856 Left 2 ;Set V_r to be sine wave with 0.2 V_{pk-pk}. Measure Frequency response of V_0
TEXT -1032 -792 Left 2 ;STEP Responses: Combined Voltage stage and motor
TEXT -1000 -752 Left 2 ;Set V_r to be 10Hz square wave, 0.2 V_{pk-pk}. Measure current output V_{io}
TEXT -1024 -824 Left 2 ;Re-connect switch S0 to connect voltage stage and motor
TEXT 2200 -184 Left 2 ;Motor Stage
TEXT -1032 -1072 Left 2 ;Turn on Sr (set V7 to be greater than Vt = 0.5V) (connects Vr to voltage stage)
TEXT 1160 -376 Left 2 ;Voltage Stage
TEXT -200 -392 Left 2 ;Current Controller Stage
TEXT -1032 -712 Left 2 ;FREQUENCY Responses: Combined Voltage stage and motor
TEXT -1000 -680 Left 2 ;Set Vr to be sinusoidal input, measure frequency response of V_0, I_0, and V_{io}
TEXT -1024 -640 Left 2 ;DESTABILIZE THE VOLTAGE STAGE
TEXT -1000 -600 Left 2 ;Disconnect Si, S0 (set V4 and V5 to be less than Vt = 0.5V)
TEXT -1000 -560 Left 2 ;Add 470 nF capacitor in parallel with Z1
TEXT -1000 -520 Left 2 ;Observe Output V_0 for step responses or sine input
TEXT 1544 -1192 Left 2 ;GENERAL NOTES
TEXT 1592 -1152 Left 2 ;To run step response simulation, set an appropriate voltage source to \nPULSE(Vinitial = -V_{pk-pk}/2, Von = V_{pk-pk}/2, Tdelay = 0, Trise = 1e-9, Tfall = 1e-9, Ton = 0.05, Tperiod = 0.1)
TEXT 1592 -1088 Left 2 ;Vinitial is lower voltage level, Von is higher voltage level. Trise and Tfall are transition times, we want these to be negligible. \nTon is half of the period, Tperiod is 0.1 which corresponds to 10 Hz.
TEXT 1592 -1024 Left 2 ;Then, go to Simulate -> Edit Simulation Cmd -> Transient. Set Stop time = 1, time to start saving data = 0, Maximum timestep = 0.1.
TEXT 1592 -992 Left 2 ;Run simulation, and select voltages or currents to measure with probe.
TEXT 1592 -920 Left 2 ;To run frequency response simulation, set appropriate voltage source to NONE, AC small signal analyis amplitude = 1, phase = 0.
TEXT 1592 -888 Left 2 ;Then, go to Simulate -> edit Simulation Cmd -> AC Analysis. Set type of sweep OCTAVE, 100 points per octave, Star frequency 1 (Hz), \nend frequency as high as you are interested in.
TEXT 1592 -832 Left 2 ;Run simulation, and select voltages or currents to measure with probe.
TEXT 1600 -760 Left 2 ;Before running simulation, or when troubleshooting results, double check that youre switches are in the correct position.\n - Vr should only be used for Lab 1 activities, meaning that when working on Lab 2, Sr should always be off and V7 should always be less than Vt = 0.5V\n - Si and S0 change in Lab 1, but are always on for Lab 2. \n \nDouble check that your resistors, capacitors and motor values match what you used in the lab experiment to properly compare results. \n \nWhen adding or removing capacitors for destabilization tasks, you can use the delete command (scissors) to remove components/wires, and insert component to add them
TEXT -1280 512 Left 2 ;These are commands for the simulation, which we can edit through Simulate -> Edit Simulation Cmd. \nDepending on whether we are doing step response or frequency analysis, either of these will be\ncommented out automatically by a semi-colon ;
RECTANGLE Normal 2288 96 2112 -160 2
RECTANGLE Normal 1152 176 1728 -352 2
RECTANGLE Normal 176 32 -208 -368 2
